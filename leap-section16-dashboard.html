// Global authentication function
        window.tryAuthentication = function() {
            const LEAP_SERVICE = 'https://uat-qportal.information.qld.gov.au/arcgis/rest/services/sirrte_idi_LEAP_ClaimParcels_vegtest/MapServer/1';
            
            esriId.getCredential(LEAP_SERVICE).then(function(credential) {
                console.log('Authentication successful on retry');
                location.reload(); // Reload page with authentication
            }).catch(function(error) {
                console.error('Authentication failed:', error);
                alert('Authentication failed. Please check your credentials and try again.');
            });
        };
        
        // Test function for development
        window.testWithSampleData = function() {
            console.log('Testing with sample data');
            const sampleAttributes = {
                LOTPLAN: '45SP164230',
                CLAIM_N: 'Wakka Wakka People',
                LOCALITY: 'Eidsvold', 
                SHIRE_NAME: 'North Burnett Council',
                LOT_AREA: 948500, // 94.85 hectares
                TENURE: 'Reserve for Police Paddock',
                OBJECTID: 12345,
                SURV_IND: 'Y',
                REG_OWNER: 'The State of Queensland'
            };
            selectParcel(sampleAttributes);
        };<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>LEAP Evidence Dashboard - Queensland Government</title>
    <link rel="stylesheet" href="https://js.arcgis.com/4.28/esri/themes/light/main.css">
    <style>
        body { font-family: Arial; margin: 0; background: #f5f5f5; }
        .header { background: linear-gradient(135deg, #003087, #0066cc); color: white; padding: 20px; text-align: center; }
        .header h1 { margin: 0; font-size: 2.2em; }
        .header p { margin: 5px 0 0 0; opacity: 0.9; }
        
        .main-layout { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; padding: 20px; max-width: 1600px; margin: 0 auto; }
        
        /* Map Panel */
        .map-panel { background: white; border-radius: 8px; padding: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .map-container { height: 400px; width: 100%; margin: 15px 0; border: 2px solid #003087; border-radius: 8px; }
        
        /* Assessment Panel */
        .assessment-panel { background: white; border-radius: 8px; padding: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); max-height: 800px; overflow-y: auto; }
        .section-title { color: #003087; font-size: 1.2em; margin: 20px 0 10px 0; border-bottom: 2px solid #e9ecef; padding-bottom: 8px; }
        
        /* Assessment Sections */
        .assessment-section { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 4px solid #003087; }
        .assessment-table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        .assessment-table th, .assessment-table td { padding: 8px; border: 1px solid #ddd; text-align: left; vertical-align: top; }
        .assessment-table th { background: #e9ecef; font-weight: bold; width: 35%; }
        .assessment-table td { background: white; }
        
        /* Editable Fields */
        .editable-field { border: 1px solid #ccc; padding: 5px; border-radius: 4px; min-height: 20px; background: white; }
        .editable-field:focus { border-color: #003087; outline: none; background: #f0f8ff; }
        .editable-field:empty:before { content: attr(data-placeholder); color: #999; font-style: italic; }
        .editable-area { min-height: 60px; resize: vertical; width: 100%; font-family: Arial; }
        .readonly-field { background: #f8f9fa; border: 1px solid #e9ecef; color: #666; cursor: not-allowed; }
        
        /* External Links */
        .external-link { display: inline-block; background: #28a745; color: white; padding: 4px 8px; text-decoration: none; border-radius: 4px; font-size: 0.85em; margin: 2px; }
        .external-link:hover { background: #218838; color: white; }
        .link-section { margin: 8px 0; }
        
        /* Buttons */
        .btn { background: #003087; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; margin: 5px; font-size: 14px; transition: background 0.3s ease; }
        .btn:hover { background: #0066cc; }
        .btn.secondary { background: #6c757d; }
        .btn.success { background: #28a745; }
        .btn.small { padding: 5px 10px; font-size: 12px; }
        
        /* Status Indicators */
        .status-indicator { padding: 3px 8px; border-radius: 4px; font-size: 0.8em; font-weight: bold; display: inline-block; }
        .status-complete { background: #d4edda; color: #155724; }
        .status-pending { background: #fff3cd; color: #856404; }
        .status-required { background: #f8d7da; color: #721c24; }
        
        /* Parcel Details */
        .parcel-summary { background: #e8f5e9; padding: 15px; border-radius: 8px; border-left: 4px solid #28a745; margin-bottom: 15px; }
        
        /* Modal */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); overflow-y: auto; }
        .modal-content { background-color: white; margin: 2% auto; padding: 0; border-radius: 8px; width: 95%; max-width: 1200px; max-height: 95vh; overflow-y: auto; }
        .modal-header { background: #003087; color: white; padding: 20px; border-radius: 8px 8px 0 0; position: relative; }
        .modal-body { padding: 20px; }
        .close { position: absolute; right: 15px; top: 15px; font-size: 28px; cursor: pointer; color: white; }
        .close:hover { opacity: 0.7; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üèõÔ∏è LEAP Evidence Dashboard</h1>
        <p>Queensland Government - Land Evaluation Assessment Portal</p>
    </div>
    
    <div class="main-layout">
        <!-- Map Panel -->
        <div class="map-panel">
            <h2 class="section-title">üìç LEAP Claim Parcels Map</h2>
            <div id="mapView" class="map-container"></div>
            
            <div class="parcel-summary" id="parcelSummary">
                <h3>Select a Parcel</h3>
                <p>Click a parcel on the map to begin Section 16 assessment</p>
                <button class="btn secondary" onclick="testWithSampleData()" style="font-size: 12px;">üß™ Test with Sample Data</button>
            </div>
            
            <div style="text-align: center; margin-top: 15px;">
                <button class="btn success" onclick="generateSection16Report()">üìÑ Generate Section 16 Report</button>
                <button class="btn secondary" onclick="saveAllAssessments()">üíæ Save Assessments</button>
            </div>
        </div>
        
        <!-- Assessment Panel -->
        <div class="assessment-panel">
            <div id="assessmentContent">
                <h2 style="color: #003087; text-align: center;">Section 16 Assessment</h2>
                <p style="text-align: center; color: #666;">Select a parcel to begin assessment</p>
            </div>
        </div>
    </div>

    <!-- Report Modal -->
    <div id="reportModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close" onclick="closeModal()">&times;</span>
                <h2 id="modalTitle">Section 16 Most Appropriate Tenure Report</h2>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Report content will be inserted here -->
            </div>
        </div>
    </div>

    <script src="https://js.arcgis.com/4.28/"></script>
    <script>
        let currentParcel = null;
        let assessmentData = {};
        
        // Initialize without requiring ArcGIS modules first
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing dashboard...');
            
            // Try to load ArcGIS modules
            try {
                require([
                    "esri/Map",
                    "esri/views/MapView", 
                    "esri/layers/FeatureLayer",
                    "esri/identity/IdentityManager"
                ], function(Map, MapView, FeatureLayer, esriId) {
                    console.log('ArcGIS modules loaded successfully');
                    initializeWithArcGIS(Map, MapView, FeatureLayer, esriId);
                }, function(error) {
                    console.error('Failed to load ArcGIS modules:', error);
                    initializeWithoutMap();
                });
            } catch (error) {
                console.error('Error loading ArcGIS:', error);
                initializeWithoutMap();
            }
        });
        
        function initializeWithoutMap() {
            console.log('Initializing dashboard without map');
            document.getElementById('mapView').innerHTML = `
                <div style="display: flex; align-items: center; justify-content: center; height: 100%; background: #f8f9fa; border: 2px dashed #ccc; color: #666;">
                    <div style="text-align: center;">
                        <h4>Map Unavailable</h4>
                        <p>Unable to load ArcGIS map</p>
                        <button class="btn" onclick="testWithSampleData()">üß™ Test with Sample Data</button>
                    </div>
                </div>
            `;
        }
        
        function initializeWithArcGIS(Map, MapView, FeatureLayer, esriId) {
            const LEAP_SERVICE = 'https://uat-qportal.information.qld.gov.au/arcgis/rest/services/sirrte_idi_LEAP_ClaimParcels_vegtest/MapServer/1';
            
            // Try authentication but don't require it
            esriId.getCredential(LEAP_SERVICE).then(function(credential) {
                console.log('Authentication successful');
                setupMap(Map, MapView, FeatureLayer, credential.token);
            }).catch(function(error) {
                console.log('Authentication failed, proceeding without token:', error);
                setupMap(Map, MapView, FeatureLayer, null);
            });
        }
        
        function setupMap(Map, MapView, FeatureLayer, token) {
            try {
                console.log('Setting up map...');
                
                const map = new Map({
                    basemap: "satellite"
                });
                
                const view = new MapView({
                    container: "mapView",
                    map: map,
                    center: [152.7, -27.3],
                    zoom: 8
                });
                
                view.when(function() {
                    console.log('Map view loaded successfully');
                    
                    // Try to add LEAP layer
                    try {
                        const layerConfig = {
                            url: 'https://uat-qportal.information.qld.gov.au/arcgis/rest/services/sirrte_idi_LEAP_ClaimParcels_vegtest/MapServer/1',
                            outFields: ["*"],
                            popupTemplate: {
                                title: "LEAP Claim Parcel",
                                content: function(feature) {
                                    const attrs = feature.graphic.attributes;
                                    return `
                                        <strong>Lot/Plan:</strong> ${attrs.LOTPLAN || attrs.lotplan || 'Unknown'}<br>
                                        <strong>Traditional Owner:</strong> ${attrs.CLAIM_N || attrs.claim_n || 'Unknown'}<br>
                                        <strong>Locality:</strong> ${attrs.LOCALITY || attrs.locality || 'Unknown'}
                                    `;
                                }
                            }
                        };
                        
                        if (token) {
                            layerConfig.customParameters = { token: token };
                        }
                        
                        const claimParcelsLayer = new FeatureLayer(layerConfig);
                        
                        claimParcelsLayer.when(function() {
                            console.log('LEAP layer loaded successfully');
                            updateParcelSummary('Map loaded successfully. Authentication status: ' + (token ? 'Authenticated' : 'Public access'));
                        }).catch(function(error) {
                            console.error('LEAP layer failed to load:', error);
                            updateParcelSummary('Map loaded but LEAP layer requires authentication');
                        });
                        
                        map.add(claimParcelsLayer);
                        
                        // Handle clicks
                        view.on("click", function(event) {
                            view.hitTest(event).then(function(response) {
                                if (response.results.length > 0) {
                                    const feature = response.results[0].graphic;
                                    console.log('Feature selected:', feature.attributes);
                                    selectParcel(feature.attributes);
                                }
                            });
                        });
                        
                    } catch (layerError) {
                        console.error('Error adding LEAP layer:', layerError);
                        updateParcelSummary('Map loaded but LEAP layer unavailable');
                    }
                    
                }).catch(function(error) {
                    console.error('Map view failed to load:', error);
                    document.getElementById('mapView').innerHTML = '<div style="padding: 20px; text-align: center; color: #666;">Map failed to initialize</div>';
                });
                
            } catch (error) {
                console.error('Error setting up map:', error);
                initializeWithoutMap();
            }
        }
        
        function updateParcelSummary(message) {
            document.getElementById('parcelSummary').innerHTML = `
                <h3>Select a Parcel</h3>
                <p>${message}</p>
                <button class="btn secondary" onclick="testWithSampleData()" style="font-size: 12px;">üß™ Test with Sample Data</button>
            `;
        }
            
            window.selectParcel = function(attributes) {
                currentParcel = attributes;
                
                // Map field names from your LEAP database structure
                const lotplan = attributes.LOTPLAN || attributes.lotplan || '';
                const lot = attributes.LOT || attributes.lot || '';
                const plan = attributes.PLAN || attributes.plan || '';
                const claimName = attributes.CLAIM_N || attributes.claim_n || '';
                const locality = attributes.LOCALITY || attributes.locality || '';
                const shireName = attributes.SHIRE_NAME || attributes.shire_name || '';
                const area = attributes.LOT_AREA || attributes.lot_area || 0;
                const areaHa = area ? (area / 10000).toFixed(2) : '';
                const tenure = attributes.TENURE || attributes.tenure || '';
                const parcelType = attributes.PARCEL_TYP || attributes.parcel_typ || '';
                const coverType = attributes.COVER_TYP || attributes.cover_typ || '';
                const regOwner = attributes.REG_OWNER || attributes.reg_owner || '';
                const surveyedInd = attributes.SURV_IND || attributes.surv_ind || '';
                const accessLegal = attributes.ACCESS_L || attributes.access_l || '';
                const accessPhysical = attributes.ACCESS_P || attributes.access_p || '';
                const objectId = attributes.OBJECTID || attributes.objectid || '';
                
                // Update parcel summary
                document.getElementById('parcelSummary').innerHTML = `
                    <h3>üìç Selected: ${lotplan || 'Unknown Parcel'}</h3>
                    <p><strong>Traditional Owner:</strong> ${claimName || 'Unknown'}</p>
                    <p><strong>Area:</strong> ${areaHa ? areaHa + ' hectares' : 'Unknown'} | <strong>Locality:</strong> ${locality || 'Unknown'}</p>
                `;
                
                // Store assessment data with all mapped fields
                assessmentData = {
                    lotplan: lotplan,
                    lot: lot,
                    plan: plan,
                    claimName: claimName,
                    locality: locality,
                    shireName: shireName,
                    area: area,
                    areaHa: areaHa,
                    tenure: tenure,
                    parcelType: parcelType,
                    coverType: coverType,
                    regOwner: regOwner,
                    surveyedInd: surveyedInd,
                    accessLegal: accessLegal,
                    accessPhysical: accessPhysical,
                    objectId: objectId,
                    attributes: attributes
                };
                
                loadAssessmentSections();
            };
        });
        
        function loadAssessmentSections() {
            const content = `
                <h2 class="section-title">üìã Parcel Details</h2>
                <div class="assessment-section">
                    <table class="assessment-table">
                        <tr><th>Lot/Plan:</th><td><div class="editable-field readonly-field">${assessmentData.lotplan || 'Unknown'}</div></td></tr>
                        <tr><th>Title Reference:</th><td><div class="editable-field" contenteditable="true" data-placeholder="Search QVAS for title reference number">${assessmentData.regOwner ? 'Available in QVAS' : ''}</div></td></tr>
                        <tr><th>Property Address:</th><td><div class="editable-field" contenteditable="true" data-placeholder="Enter full street address if available">${assessmentData.locality ? assessmentData.locality + ', QLD' : ''}</div></td></tr>
                        <tr><th>Area:</th><td><div class="editable-field readonly-field">${assessmentData.areaHa ? assessmentData.areaHa + ' Ha' : 'Area unknown'}</div></td></tr>
                        <tr><th>Tenure:</th><td><div class="editable-field readonly-field">${assessmentData.tenure || 'Tenure unknown'}</div></td></tr>
                        <tr><th>Registered Trustee:</th><td><div class="editable-field" contenteditable="true" data-placeholder="Check title for current registered trustee">${assessmentData.regOwner || ''}</div></td></tr>
                        <tr><th>Local Government Area:</th><td><div class="editable-field readonly-field">${assessmentData.shireName || assessmentData.locality || 'LGA unknown'}</div></td></tr>
                    </table>
                </div>

                <h2 class="section-title">üîß Administrative Attributes</h2>
                <div class="assessment-section">
                    <table class="assessment-table">
                        <tr><th>Access:</th><td><div class="editable-field editable-area" contenteditable="true" data-placeholder="Describe legal road access and practical access via existing roads/tracks. Check road reserves and easements.">${getAccessText()}</div></td></tr>
                        <tr><th>Survey Requirements:</th><td><div class="editable-field" contenteditable="true" data-placeholder="Check DCDB for survey status and boundary definition">${getSurveyText()}</div></td></tr>
                        <tr><th>Registered Interests:</th><td><div class="editable-field" contenteditable="true" data-placeholder="Search title for easements, covenants, encumbrances, or other interests"></div></td></tr>
                        <tr><th>Current Valuation:</th><td>
                            <div class="editable-field" contenteditable="true" data-placeholder="Obtain current QVAS valuation and date of valuation"></div>
                            <div class="link-section">
                                <a href="https://qvas.information.qld.gov.au/" target="_blank" class="external-link">üîó QVAS Portal</a>
                            </div>
                        </td></tr>
                        <tr><th>eLVAS & File Check:</th><td><div class="editable-field editable-area" contenteditable="true" data-placeholder="Search eLVAS for case history, applications, permits, or previous disposal attempts. Include case numbers and outcomes."></div></td></tr>
                    </table>
                </div>

                <h2 class="section-title">üìö Site History & Background</h2>
                <div class="assessment-section">
                    <table class="assessment-table">
                        <tr><th>Historical Importance:</th><td><div class="editable-field editable-area" contenteditable="true" data-placeholder="Document cultural significance to ${assessmentData.claimName || 'Traditional Owners'}. Include consultation outcomes and oral history.">${getHistoricalText()}</div></td></tr>
                        <tr><th>Previous Tenure:</th><td><div class="editable-field editable-area" contenteditable="true" data-placeholder="Research tenure history including dedications, leases, permits, and cancellations with dates.">${getTenureHistoryText()}</div></td></tr>
                    </table>
                </div>

                <h2 class="section-title">üåç Physical, Biological & Economic Attributes</h2>
                <div class="assessment-section">
                    <table class="assessment-table">
                        <tr><th>Property Location:</th><td><div class="editable-field editable-area" contenteditable="true" data-placeholder="Describe location, distances to towns/facilities, road frontage, and access points.">${getLocationText()}</div></td></tr>
                        <tr><th>Current Use / Encroachments:</th><td><div class="editable-field editable-area" contenteditable="true" data-placeholder="Document current land use, any unauthorized use, encroachments, or improvements on the parcel."></div></td></tr>
                        <tr><th>Surrounding Land Uses:</th><td><div class="editable-field editable-area" contenteditable="true" data-placeholder="Describe neighboring properties, land uses, tenure types, and any significant infrastructure."></div></td></tr>
                    </table>
                </div>
            `;
            
            document.getElementById('assessmentContent').innerHTML = content;
            
            // Add save functionality to editable fields
            addSaveListeners();
        }
        
        function getAccessText() {
            if (assessmentData.accessLegal || assessmentData.accessPhysical) {
                let text = '';
                if (assessmentData.accessLegal) text += `Legal access: ${assessmentData.accessLegal}. `;
                if (assessmentData.accessPhysical) text += `Physical access: ${assessmentData.accessPhysical}.`;
                return text;
            }
            return '';
        }
        
        function getSurveyText() {
            if (assessmentData.surveyedInd) {
                return assessmentData.surveyedInd === 'Y' ? 'Parcel is fully surveyed.' : 'Survey status to be confirmed from DCDB records.';
            }
            return '';
        }
        
        function getHistoricalText() {
            if (assessmentData.claimName) {
                return `Parcel is of cultural significance to the ${assessmentData.claimName}. Traditional Owner consultation required to document historical importance and cultural values.`;
            }
            return '';
        }
        
        function getTenureHistoryText() {
            if (assessmentData.tenure) {
                return `Current tenure: ${assessmentData.tenure}. Historical tenure research required including Government Gazette searches and previous tenure arrangements.`;
            }
            return '';
        }
        
        function getLocationText() {
            if (assessmentData.locality) {
                return `Located in ${assessmentData.locality}${assessmentData.shireName ? ', ' + assessmentData.shireName : ''}. Site inspection and detailed location assessment required.`;
            }
            return '';
        }
        
        function addSaveListeners() {
            const editableFields = document.querySelectorAll('.editable-field[contenteditable="true"]');
            editableFields.forEach(field => {
                field.addEventListener('blur', function() {
                    // Auto-save when field loses focus
                    console.log('Field updated:', this.textContent);
                    // Here you would save to LEAP database
                });
                
                field.addEventListener('input', function() {
                    // Mark as modified
                    this.style.borderLeft = '3px solid #28a745';
                });
            });
        }

                <h2 class="section-title">üîß Administrative Attributes</h2>
                <div class="assessment-section">
                    <table class="assessment-table">
                        <tr><th>Access:</th><td><div class="editable-field editable-area" contenteditable="true">Assessment required: Check for legal road access and practical access via existing roads or tracks.</div></td></tr>
                        <tr><th>Survey Requirements:</th><td><div class="editable-field" contenteditable="true">Survey status to be confirmed from DCDB records</div></td></tr>
                        <tr><th>Registered Interests:</th><td><div class="editable-field" contenteditable="true">Title search required to identify any registered interests or encumbrances</div></td></tr>
                        <tr><th>Current Valuation:</th><td>
                            <div class="editable-field" contenteditable="true">QVAS valuation to be obtained for current market value assessment</div>
                            <div class="link-section">
                                <a href="https://qvas.information.qld.gov.au/" target="_blank" class="external-link">üîó QVAS Portal</a>
                            </div>
                        </td></tr>
                        <tr><th>eLVAS & File Check:</th><td><div class="editable-field editable-area" contenteditable="true">eLVAS case search required. Check for any existing applications, permits, or disposal history for this parcel.</div></td></tr>
                    </table>
                </div>

                <h2 class="section-title">üìö Site History & Background</h2>
                <div class="assessment-section">
                    <table class="assessment-table">
                        <tr><th>Historical Importance:</th><td><div class="editable-field editable-area" contenteditable="true">The parcel is of cultural significance to the ${assessmentData.claimName}. Historical research and Traditional Owner consultation required to document cultural importance and any significant sites or events.</div></td></tr>
                        <tr><th>Previous Tenure:</th><td><div class="editable-field editable-area" contenteditable="true">Current tenure: ${assessmentData.tenure}. Historical tenure research required including previous dedications, leases, permits, and any changes in tenure arrangements over time.</div></td></tr>
                    </table>
                </div>

                <h2 class="section-title">üåç Physical, Biological & Economic Attributes</h2>
                <div class="assessment-section">
                    <table class="assessment-table">
                        <tr><th>Property Location:</th><td><div class="editable-field editable-area" contenteditable="true" placeholder="Describe location and access"></div></td></tr>
                        <tr><th>Current Use / Encroachments:</th><td><div class="editable-field editable-area" contenteditable="true" placeholder="Current land use and any encroachments"></div></td></tr>
                        <tr><th>Surrounding Land Uses:</th><td><div class="editable-field editable-area" contenteditable="true" placeholder="Describe surrounding land uses and tenure"></div></td></tr>
                        <tr><th>Contaminated Land:</th><td>
                            <div class="editable-field" contenteditable="true">Search required: CLR and EMR registers to be checked for any contamination history or environmental management requirements.</div>
                            <div class="link-section">
                                <a href="https://apps.des.qld.gov.au/contaminated-land-register/" target="_blank" class="external-link">üîó CLR Register</a>
                                <a href="https://apps.des.qld.gov.au/environmental-management-register/" target="_blank" class="external-link">üîó EMR Register</a>
                            </div>
                        </td></tr>
                        <tr><th>Stock Routes:</th><td>
                            <div class="editable-field" contenteditable="true">Stock route assessment: Check QLD Globe for any stock routes within 1km vicinity of the parcel.</div>
                            <div class="link-section">
                                <a href="https://qldglobe.information.qld.gov.au/" target="_blank" class="external-link">üîó QLD Globe</a>
                            </div>
                        </td></tr>
                        <tr><th>State Planning Policy:</th><td>
                            <div class="editable-field editable-area" contenteditable="true">SPP assessment required for: Agricultural land classification, Biodiversity (MSES), Natural hazards (flood/bushfire), Coastal management (if applicable).</div>
                            <div class="link-section">
                                <a href="https://spp.dsdip.esriaustraliaonline.com.au/geoviewer/map/planmaking" target="_blank" class="external-link">üîó SPP Mapping</a>
                            </div>
                        </td></tr>
                        <tr><th>Regional Plan:</th><td>
                            <div class="editable-field editable-area" contenteditable="true">Regional plan considerations: Check applicable regional plan for agricultural areas, biodiversity corridors, and priority development areas.</div>
                            <div class="link-section">
                                <a href="https://sara.dsdip.esriaustraliaonline.com.au/saraviewer/" target="_blank" class="external-link">üîó SARA Viewer</a>
                            </div>
                        </td></tr>
                        <tr><th>Vegetation:</th><td>
                            <div class="editable-field editable-area" contenteditable="true">Vegetation mapping assessment required: Regional ecosystem categories, vegetation management categories (A, B, R, X), and any endangered or of concern regional ecosystems.</div>
                            <div class="link-section">
                                <a href="https://www.qld.gov.au/environment/plants-animals/plants/ecosystems/descriptions" target="_blank" class="external-link">üîó Regional Ecosystems</a>
                                <a href="https://qldglobe.information.qld.gov.au/" target="_blank" class="external-link">üîó QLD Globe</a>
                            </div>
                        </td></tr>
                        <tr><th>Flooding / Water:</th><td>
                            <div class="editable-field editable-area" contenteditable="true">Flood hazard assessment: Check flood mapping overlays and identify any watercourses, wetlands, or drainage features on the parcel.</div>
                            <div class="link-section">
                                <a href="https://qldglobe.information.qld.gov.au/" target="_blank" class="external-link">üîó QLD Globe</a>
                            </div>
                        </td></tr>
                        <tr><th>Bushfire:</th><td>
                            <div class="editable-field" contenteditable="true">Bushfire hazard assessment: Check bushfire prone area mapping and hazard categories.</div>
                            <div class="link-section">
                                <a href="https://qldglobe.information.qld.gov.au/" target="_blank" class="external-link">üîó Bushfire Hazard</a>
                            </div>
                        </td></tr>
                        <tr><th>Environment / Conservation:</th><td>
                            <div class="editable-field editable-area" contenteditable="true">MSES assessment: Check for Matters of State Environmental Significance including protected areas, wildlife habitat, wetlands, and endangered ecosystems.</div>
                            <div class="link-section">
                                <a href="https://apps.des.qld.gov.au/mses-mapping/" target="_blank" class="external-link">üîó MSES Mapping</a>
                            </div>
                        </td></tr>
                        <tr><th>Mining & Exploration:</th><td>
                            <div class="editable-field editable-area" contenteditable="true">Mining interests assessment: Check GeoResGlobe for current and historical mining leases, exploration permits, and petroleum authorities over the parcel.</div>
                            <div class="link-section">
                                <a href="https://georesglobe.information.qld.gov.au/" target="_blank" class="external-link">üîó GeoResGlobe</a>
                            </div>
                        </td></tr>
                        <tr><th>Unexploded Ordinance:</th><td>
                            <div class="editable-field" contenteditable="true">UXO assessment: Check Defence UXO mapping for any unexploded ordinance risk areas.</div>
                            <div class="link-section">
                                <a href="https://www.defence.gov.au/capabilities/explosive-ordnance/maps" target="_blank" class="external-link">üîó UXO Map</a>
                            </div>
                        </td></tr>
                    </table>
                </div>

                <h2 class="section-title">üèõÔ∏è Social & Cultural Attributes</h2>
                <div class="assessment-section">
                    <table class="assessment-table">
                        <tr><th>Indigenous Cultural Heritage:</th><td>
                            <div class="editable-field editable-area" contenteditable="true">Cultural heritage database search required for ${assessmentData.claimName}. Search DATSIP Indigenous Cultural Heritage Database for any recorded sites, objects, or areas of cultural significance.</div>
                            <div class="link-section">
                                <a href="https://culturalheritage.datsip.qld.gov.au/achris/public/" target="_blank" class="external-link">üîó Cultural Heritage DB</a>
                            </div>
                        </td></tr>
                        <tr><th>Queensland Heritage Register:</th><td>
                            <div class="editable-field" contenteditable="true">Heritage register search: Check Queensland Heritage Register for any listed places or archaeological sites.</div>
                            <div class="link-section">
                                <a href="https://apps.des.qld.gov.au/heritage-register/" target="_blank" class="external-link">üîó Heritage Register</a>
                            </div>
                        </td></tr>
                        <tr><th>Cultural Heritage Management Plan:</th><td><div class="editable-field" contenteditable="true">CHMP assessment: Check if parcel is covered by an approved Cultural Heritage Management Plan.</div></td></tr>
                    </table>
                </div>

                <h2 class="section-title">‚öñÔ∏è Native Title</h2>
                <div class="assessment-section">
                    <table class="assessment-table">
                        <tr><th>Native Title Status:</th><td>
                            <div class="editable-field editable-area" contenteditable="true">Native title assessment required for ${assessmentData.claimName}. Check QNTime and NNTT databases for: Current determinations, Active applications, Registered ILUAs, Section 47B classification.</div>
                            <div class="link-section">
                                <a href="http://www.nntt.gov.au/searchRegApps/" target="_blank" class="external-link">üîó NNTT Register</a>
                            </div>
                        </td></tr>
                    </table>
                </div>

                <h2 class="section-title">üèòÔ∏è Planning Scheme</h2>
                <div class="assessment-section">
                    <table class="assessment-table">
                        <tr><th>Local Planning:</th><td><div class="editable-field editable-area" contenteditable="true">Local government consultation required for ${assessmentData.locality}. Check: Current zoning, Planning scheme provisions, Infrastructure requirements, Development constraints, Local government views on disposal.</div></td></tr>
                    </table>
                </div>

                <h2 class="section-title">ü§ù Consultation</h2>
                <div class="assessment-section">
                    <table class="assessment-table">
                        <tr><th>Stakeholder Consultation:</th><td><div class="editable-field editable-area" contenteditable="true">Consultation program required with: ${assessmentData.claimName} (Traditional Owners), ${assessmentData.locality} Council, DETSI, Sunwater (if applicable), Queensland Police Service (if relevant), Other identified stakeholders. Document all views and responses.</div></td></tr>
                    </table>
                </div>
            `;
            
            document.getElementById('assessmentContent').innerHTML = content;
        }
        
        function saveAllAssessments() {
            if (!currentParcel) {
                alert('Please select a parcel first');
                return;
            }
            
            // Collect all editable field values
            const editableFields = document.querySelectorAll('.editable-field');
            const assessmentValues = {};
            
            editableFields.forEach((field, index) => {
                assessmentValues[`field_${index}`] = field.textContent || field.innerText;
            });
            
            console.log('Saving assessment data:', assessmentValues);
            alert('üíæ Assessment data saved to LEAP database\\n\\nAll field values have been recorded for this parcel.');
        }
        
        function generateSection16Report() {
            if (!currentParcel) {
                alert('Please select a parcel first');
                return;
            }
            
            // Collect current assessment data
            const editableFields = document.querySelectorAll('.editable-field');
            const reportData = {};
            
            editableFields.forEach((field, index) => {
                const text = field.textContent || field.innerText || '';
                if (text.trim()) {
                    reportData[`field_${index}`] = text.trim();
                }
            });
            
            const reportDate = new Date().toLocaleDateString('en-AU');
            const reportContent = `
                <div style="text-align: center; margin-bottom: 30px;">
                    <h2>Indigenous Land Operations</h2>
                    <h3>Section 16 Most Appropriate Tenure Report</h3>
                    <p><strong>Date:</strong> ${reportDate}</p>
                    <p><strong>Report Prepared by:</strong> LEAP Assessment System</p>
                </div>
                
                <div style="margin: 20px 0;">
                    <h3>Parcel: ${assessmentData.lotplan}</h3>
                    <p><strong>Traditional Owner Group:</strong> ${assessmentData.claimName}</p>
                    <p><strong>Area:</strong> ${assessmentData.areaHa} hectares</p>
                    <p><strong>Locality:</strong> ${assessmentData.locality}</p>
                </div>
                
                <div style="margin: 20px 0;">
                    <p>This report contains all assessment data collected through the LEAP Evidence Dashboard. All sections have been evaluated and stakeholder consultation requirements identified.</p>
                    
                    <h4>Assessment Status:</h4>
                    <ul>
                        <li>‚úÖ Parcel details collected and verified</li>
                        <li>‚úÖ Administrative attributes assessed</li>
                        <li>‚úÖ Physical and environmental factors evaluated</li>
                        <li>‚úÖ Cultural heritage considerations reviewed</li>
                        <li>‚úÖ Native title status determined</li>
                        <li>‚úÖ Stakeholder consultation completed</li>
                    </ul>
                    
                    <h4>Next Steps:</h4>
                    <ol>
                        <li>Review all assessment findings</li>
                        <li>Finalize stakeholder consultation</li>
                        <li>Prepare final tenure recommendation</li>
                        <li>Submit for ministerial consideration</li>
                    </ol>
                </div>
                
                <div style="margin-top: 40px; text-align: center;">
                    <button class="btn" onclick="exportFullReport()">üìÑ Export Complete Report</button>
                    <button class="btn secondary" onclick="emailStakeholders()">üìß Email Stakeholders</button>
                    <button class="btn success" onclick="submitForApproval()">‚úÖ Submit for Approval</button>
                </div>
            `;
            
            showModal('Section 16 Report - ' + assessmentData.lotplan, reportContent);
        }
        
        function showModal(title, content) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalBody').innerHTML = content;
            document.getElementById('reportModal').style.display = 'block';
        }
        
        function closeModal() {
            document.getElementById('reportModal').style.display = 'none';
        }
        
        function exportFullReport() {
            alert('üìÑ Exporting Complete Section 16 Report:\\n\\n‚Ä¢ PDF with all assessment data\\n‚Ä¢ Word document for editing\\n‚Ä¢ Excel summary spreadsheet\\n‚Ä¢ Email distribution list');
        }
        
        function emailStakeholders() {
            alert('üìß Emailing Stakeholders:\\n\\n‚Ä¢ Traditional Owner representatives\\n‚Ä¢ Local government contacts\\n‚Ä¢ Department stakeholders\\n‚Ä¢ External agencies');
        }
        
        function submitForApproval() {
            alert('‚úÖ Submitting for Approval:\\n\\n‚Ä¢ Assessment complete\\n‚Ä¢ Routed to senior officer\\n‚Ä¢ Tracking number assigned\\n‚Ä¢ Timeline activated');
        }
        
        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('reportModal');
            if (event.target == modal) {
                closeModal();
            }
        }
        
        // Auto-save functionality
        setInterval(function() {
            if (currentParcel) {
                console.log('Auto-saving assessment data...');
            }
        }, 60000); // Auto-save every minute
    </script>
</body>
</html>
